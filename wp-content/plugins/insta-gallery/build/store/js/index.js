!function(){"use strict";var e={n:function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,{a:s}),s},d:function(t,s){for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{INITIAL_STATE:function(){return a},STORE_NAME:function(){return i},actions:function(){return n},apiFetch:function(){return F},clearFeedCache:function(){return b},fetchRestApiAccounts:function(){return m},fetchRestApiFeeds:function(){return w},fetchRestApiSettings:function(){return _},fetchRestApiUserProfile:function(){return R},reducer:function(){return s},resolvers:function(){return r},selectors:function(){return c},storeConfig:function(){return H},useAccountsEntities:function(){return T},useFeedsEntities:function(){return A},useSettingsEntities:function(){return E}});var s={};e.r(s),e.d(s,{accounts:function(){return u},default:function(){return g},feeds:function(){return d},settings:function(){return l}});var n={};e.r(n),e.d(n,{createAccount:function(){return P},createFeed:function(){return C},deleteAccount:function(){return j},deleteFeed:function(){return D},editFeed:function(){return I},saveSettings:function(){return q},setAccounts:function(){return O},setFeeds:function(){return N},setSettings:function(){return k}});var c={};e.r(c),e.d(c,{getAccounts:function(){return M},getFeeds:function(){return U},getSettings:function(){return L}});var r={};e.r(r),e.d(r,{getAccounts:function(){return G},getFeeds:function(){return $},getSettings:function(){return x}});var o=window.wp.data;const i="qligg",a={accounts:{},feeds:[],settings:{}};function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.accounts,t=arguments.length>1?arguments[1]:void 0;return"SET_ACCOUNTS"===t.type?t.payload:e}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.feeds,t=arguments.length>1?arguments[1]:void 0;return"SET_FEEDS"===t.type?t.payload:e}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.settings,t=arguments.length>1?arguments[1]:void 0;return"SET_SETTINGS"===t.type?t.payload:e}var g=(0,o.combineReducers)({accounts:u,feeds:d,settings:l}),f=window.lodash,h=window.wp.i18n,p=window.wp.notices,y=window.wp.apiFetch,S=e.n(y);const v=qligg_store_routes;async function F(e){return await S()(e).then((e=>{if(e.code)throw new Error(`${e.code}: ${e?.message||"Unknown"}`);return e})).catch((e=>{throw new Error(e)}))}const w=function(){let{method:e,data:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return F({path:v.feeds,method:e,data:t})};function A(){const{createFeed:e,editFeed:t,deleteFeed:s}=(0,o.useDispatch)(i),{feeds:n,isResolvingFeeds:c,hasResolvedFeeds:r}=(0,o.useSelect)((e=>{const{isResolving:t,hasFinishedResolution:s,getFeeds:n}=e(i);return{feeds:Object.values(n()),isResolvingFeeds:t("getFeeds"),hasResolvedFeeds:s("getFeeds")}}),[]);return{feeds:n,isResolvingFeeds:c,hasResolvedFeeds:r,hasFeeds:!(!r||!Object.keys(n)?.length),createFeed:e,editFeed:t,deleteFeed:s}}function b(e){let{method:t,data:s}=e;return F({path:v.cache,method:t,data:s})}const m=function(){let{method:e,data:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return F({path:v.accounts,method:e,data:t})},R=e=>{let{method:t,data:s}=e;return F({path:v.userProfile,method:t,data:s})};function T(){const{createAccount:e,deleteAccount:t}=(0,o.useDispatch)(i),{accounts:s,isResolvingAccounts:n,hasResolvedAccounts:c}=(0,o.useSelect)((e=>{const{isResolving:t,hasFinishedResolution:s,getAccounts:n}=e(i);return{accounts:Object.values(n()),isResolvingAccounts:t("getAccounts"),hasResolvedAccounts:s("getAccounts")}}),[]);return{accounts:s,isResolvingAccounts:n,hasResolvedAccounts:c,hasAccounts:!(!c||!Object.keys(s)?.length),createAccount:e,deleteAccount:t}}const _=function(){let{method:e,data:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return F({path:v.settings,method:e,data:t})};function E(){const{saveSettings:e}=(0,o.useDispatch)(i),{settings:t,isResolvingSettings:s,hasResolvedSettings:n}=(0,o.useSelect)((e=>{const{isResolving:t,hasFinishedResolution:s,getSettings:n}=e(i);return{settings:n(),isResolvingSettings:t("getSettings"),hasResolvedSettings:s("getSettings")}}),[]);return{settings:t,isResolvingSettings:s,hasResolvedSettings:n,hasSettings:!(!n||!Object.keys(t)?.length),saveSettings:e}}const O=e=>({type:"SET_ACCOUNTS",payload:e}),N=e=>({type:"SET_FEEDS",payload:e}),k=e=>({type:"SET_SETTINGS",payload:e}),P=e=>async t=>{let{registry:s,dispatch:n,select:c}=t;const r=await m({method:"POST",data:e});if(r?.code)return s.dispatch(p.store).createSuccessNotice((0,h.sprintf)("%s: %s",r.code,r.message),{type:"snackbar"}),!1;const o=c.getAccounts();return n.setAccounts({...o,[r.id]:r}),s.dispatch(p.store).createSuccessNotice((0,h.__)("The account has been updated successfully.","insta-gallery"),{type:"snackbar"}),!0},j=e=>async t=>{let{registry:s,dispatch:n,select:c}=t;const r=await m({method:"DELETE",data:{id:e}});if(r?.code)return s.dispatch(p.store).createSuccessNotice((0,h.sprintf)("%s: %s",r.code,r.message),{type:"snackbar"}),!1;const o=c.getAccounts(),i=(0,f.filter)(o,(t=>t.id!==e));return n.setAccounts({...i}),s.dispatch(p.store).createSuccessNotice((0,h.sprintf)((0,h.__)("The account %s has been deleted.","insta-gallery"),e),{type:"snackbar"}),!0},C=e=>async t=>{let{registry:s,dispatch:n,select:c}=t;const r=await w({method:"POST",data:{feed:e}});if(r?.code)return s.dispatch(p.store).createSuccessNotice((0,h.sprintf)("%s: %s",r.code,r.message),{type:"snackbar"}),!1;const o=c.getFeeds();return o.push(r),n.setFeeds([...o]),s.dispatch(p.store).createSuccessNotice((0,h.__)("The feed has been created successfully.","insta-gallery"),{type:"snackbar"}),!0},D=e=>async t=>{let{registry:s,dispatch:n,select:c}=t;const r=await w({method:"DELETE",data:{feed_settings:e}});if(r?.code)return s.dispatch(p.store).createSuccessNotice((0,h.sprintf)("%s: %s",r.code,r.message),{type:"snackbar"}),!1;const o=c.getFeeds().filter((t=>t.id!==e.id));return n.setFeeds([...o]),s.dispatch(p.store).createSuccessNotice((0,h.sprintf)((0,h.__)("The feed %s has been deleted.","insta-gallery"),e.id),{type:"snackbar"}),!0},I=e=>async t=>{let{registry:s,dispatch:n,select:c}=t;const r=await w({method:"PATCH",data:{feed:e}});if(r?.code)return s.dispatch(p.store).createSuccessNotice((0,h.sprintf)("%s: %s",r.code,r.message),{type:"snackbar"}),!1;const o=c.getFeeds();return n.setFeeds([...o.map((t=>t.id===e.id?e:t))]),s.dispatch(p.store).createSuccessNotice((0,h.__)("The feed has been updated successfully.","insta-gallery"),{type:"snackbar"}),!0},q=e=>async t=>{let{registry:s,dispatch:n}=t;const c=await _({method:"POST",data:e});return c?.code?(s.dispatch(p.store).createSuccessNotice((0,h.sprintf)("%s: %s",c.code,c.message),{type:"snackbar"}),!1):(n.setSettings({...e}),s.dispatch(p.store).createSuccessNotice((0,h.__)("Settings saved.","insta-gallery"),{type:"snackbar"}),!0)},M=(e,t)=>t&&e.accounts[t]?e.accounts[t]:e.accounts,U=(e,t)=>t&&e.feeds[t]?e.feeds[t]:e.feeds,L=e=>e.settings,G=async()=>{try{const e=await m(),t=Object.values(e),s=await Promise.all(t.map((async e=>{let t={};try{t=await R({method:"POST",data:{feedSettings:{account_id:e.id}}})}catch(e){console.log(e)}return delete t.id,{...e,...t}})));return O(s)}catch(e){console.error(e)}},$=async()=>{try{const e=await w();return N(Object.values(e))}catch(e){console.error(e)}},x=async()=>{try{const e=await _();return k(e)}catch(e){console.error(e)}},H={reducer:g,actions:n,selectors:c,resolvers:r},z=(0,o.createReduxStore)(i,H);(0,o.register)(z),(window.qligg=window.qligg||{}).store=t}();